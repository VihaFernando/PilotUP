name: Deploy Notification

on:
  push:
    branches:
      - main

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Send deployment message to Discord
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%s)

          cat <<EOF > payload.json
          {
            "content": "ðŸš€ **Deployment!**\n\nBranch: **${{ github.ref_name }}**\nAuthor: **${{ github.actor }}**\nCommit message: **$COMMIT_MSG**"
          }
          EOF

          curl -X POST \
            -H "Content-Type: application/json" \
            --data @payload.json \
            "${{ secrets.PILOTUP_WEB }}"
